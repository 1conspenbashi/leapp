<div class="container-fluid">
  <form [formGroup]="form" class="form center-vertical text-left">

    <!-- ================================================================== -->
    <!-- == CASES FOR MANAGING PROVIDER AND ACCOUNT SELECTION STRATEGIES == -->
    <!-- ================================================================== -->
    <ng-container *ngIf="!providerSelected">
      <h1>Choose your Provider</h1>
      <p>To define your Access Strategy, select the Cloud Provider you need to connect to</p>

      <div class="form-group" style="width: 100%; display: inline-block;">
        <label>My cloud provider is:</label>
        <br>
        <div class="correct-top">
        <button type="button" class="providers" (click)="setProvider(eAccountType.awsIamRoleFederated);"><img src="assets/images/aws-logo.svg" height="20"></button>
        <button type="button" class="providers" (click)="setProvider(eAccountType.azure);"><img src="assets/images/azure-logo.svg" height="20"></button>
        </div>
      </div>

      <h1>Choose your Integration</h1>
      <p>To define your Access Strategy, select your Leapp integration.</p>

      <div class="form-group" style="width: 100%; display: inline-block;">
        <label>My integration is:</label>
        <br>
        <div class="correct-top">
          <button type="button" class="providers" (click)="goToAwsSso()"><img src="assets/images/aws-sso-logo.png" height="20"></button>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="provider !== eAccountType.azure && providerSelected && typeSelection">
      <h1>Choose your Access Strategy</h1>
      <p class="smaller">I’m not sure of what’s my Access Strategy? Know more <a class="link-wiki" (click)="openAccessStrategyDocumentation();">here</a></p>
      <div class="form-group" style="width: 100%; display: inline-block;">
        <label>My Access Strategy is:</label>
        <br>
        <ng-container *ngIf="sessionType === undefined">
            <div class="correct-top">
              <button type="button" class="providers {{sessionType === eAccountType.awsIamRoleFederated ? 'selected' : ''}}" (click)="hasSsoUrl = true; setAccessStrategy(eAccountType.awsIamRoleFederated);">
                Federated
              </button>
              <button type="button" class="providers {{sessionType === eAccountType.awsIamUser ? 'selected' : ''}}" (click)="setAccessStrategy(eAccountType.awsIamUser);">
                Plain
              </button>
              <button type="button" class="providers {{sessionType === eAccountType.awsIamRoleChained ? 'selected' : ''}}" (click)="setAccessStrategy(eAccountType.awsIamRoleChained);" *ngIf="!firstTime">
                Truster
              </button>
              <span class="providers disabled second-step-fix" *ngIf="firstTime">
                Truster
              </span>
            </div>
        </ng-container>
      </div>
    </ng-container>
    <!-- ================================================================== -->
    <!-- ================================================================== -->
    <!-- ================================================================== -->

    <ng-container *ngIf="((provider !== eAccountType.awsIamRoleFederated) || (hasSsoUrl && (provider === eAccountType.awsIamRoleFederated))) && !typeSelection && providerSelected">

      <h1>Choose your Access Strategy</h1>
      <p class="smaller">I’m not sure of what’s my Access Strategy? Know more <a class="link-wiki" (click)="openAccessStrategyDocumentation();">here</a></p>
      <div style="width: 100%; display: inline-block;">
        <!-- ================================================================== -->
        <!-- ==                    LOGO FOR AWS ACCOUNTS ARE                 == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType !== eAccountType.azure">
          <div class="form-group" style="width: 49%; display: inline-block;">
            <label>My Access Strategy is:</label>
            <br>
            <span class="providers">
              <ng-container *ngIf="sessionType === eAccountType.awsIamRoleFederated">Federated</ng-container>
              <ng-container *ngIf="sessionType === eAccountType.awsIamRoleChained">Truster</ng-container>
              <ng-container *ngIf="sessionType === eAccountType.awsIamUser">Plain</ng-container>
            </span>
            <br><br>
          </div>
        </ng-container>

        <!-- ================================================================== -->
        <!-- ==                  LOGO FOR AZURE ACCOUNTS ARE                 == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType === eAccountType.azure">
          <div class="form-group" style="width: 100%; display: inline-block">
            <label>My Access Strategy is:</label>
            <br>
            <span class="providers">
              <ng-container *ngIf="sessionType === eAccountType.azure">Azure</ng-container>
            </span>
            <br><br>
          </div>
        </ng-container>

        <!-- ================================================================== -->
        <!-- ==                      PROFILE ID SELECTION                    == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType !== eAccountType.azure">
          <div class="form-group" style="width: 2%; display: inline-block;"></div>
          <div class="form-group" style="width: 49%; display: inline-block;">
            <label>aws Profile</label>
            <ng-select [items]="profiles"
                       [addTag]="addNewProfile"
                       formControlName="awsProfile"
                       placeholder="add a profile *"
                       [(ngModel)]="selectedProfile">
            </ng-select>
            <small class="text-error" *ngIf="(form.controls['awsProfile'].dirty || form.controls['awsProfile'].touched) && form.get('awsProfile').value === undefined">Insert the aws Profile</small>
          </div>
        </ng-container>
      </div>

      <!-- ================================================================== -->
      <!-- ==              ACCOUNT ALIAS FOR ALL ACCOUNTS TYPE             == -->
      <!-- ================================================================== -->
      <div class="form-group d-inline-block" [ngStyle]="{width: sessionType === eAccountType.awsIamRoleFederated ? '49%' : '100%'}">
        <label>Account Alias<span class="danger-text">*</span></label>
        <br>
        <input formControlName="name" type="text" class="form-control" placeholder="Account Alias *">
        <small class="text-error" *ngIf="(form.controls['name'].dirty || form.controls['name'].touched) && form.controls['name'].errors">Insert an Account Alias</small>
      </div>
      <div class="form-group" style="width: 2%; display: inline-block;" *ngIf="sessionType === eAccountType.awsIamRoleFederated"></div>

      <!-- ====================== -->
      <!-- AWS ACCOUNT PROPERTIES -->
      <!-- ====================== -->
      <ng-container *ngIf="sessionType !== eAccountType.azure">
        <!-- ================================================================== -->
        <!-- ==                        AWS REGION ALL                        == -->
        <!-- ================================================================== -->
        <div class="form-group" [ngStyle]="{display: 'inline-block', width: sessionType === eAccountType.awsIamRoleFederated ? '49%': '100%'}">
          <label>aws Region</label>
          <ng-select formControlName="awsRegion" bindLabel="region" bindValue="region" [items]="regions" [(ngModel)]="selectedRegion" dropdownPosition="top"></ng-select>
        </div>

        <!-- ================================================================== -->
        <!-- ==                 ROLE ARN FEDERATED & TRUSTER                 == -->
        <!-- ================================================================== -->
        <div class="form-group" style="width: 100%; display: inline-block;" *ngIf="sessionType === eAccountType.awsIamRoleFederated || sessionType === eAccountType.awsIamRoleChained">
          <label>RoleArn<span class="danger-text">*</span></label>
          <input formControlName="roleArn" type="text" class="form-control" placeholder="Role ARN" />
          <small class="text-error" *ngIf="(form.controls['roleArn'].dirty || form.controls['roleArn'].touched) && form.controls['roleArn'].errors">Insert the Role ARN</small>
        </div>

        <!-- ================================================================== -->
        <!-- ==                 SAML & IDP ARN FOR FEDERATED                 == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType === eAccountType.awsIamRoleFederated">
          <h2>Federated setting</h2>
          <div class="form-group" style="width: 100%; display: inline-block;">
            <label>SAML 2.0 Url<span class="danger-text">*</span></label>
            <ng-select [items]="idps"
                       [addTag]="addNewSSO"
                       formControlName="federationUrl"
                       placeholder="single sign-on url *"
                       [(ngModel)]="selectedIdpUrl">
            </ng-select>
            <small class="text-error" *ngIf="(form.controls['federationUrl'].dirty || form.controls['federationUrl'].touched) && form.get('federationUrl').value === undefined">Insert the SAML 2.0 Url</small>
          </div>

          <div class="form-group" style="width: 100%; display: inline-block;">
            <label>IdP ARN<span class="danger-text">*</span></label>
            <input formControlName="idpArn" type="text" class="form-control" placeholder="Idp Arn *">
            <small class="text-error" *ngIf="(form.controls['idpArn'].dirty || form.controls['idpArn'].touched) && form.controls['idpArn'].errors">Insert the IdP ARN</small>
          </div>
        </ng-container>

        <!-- ================================================================== -->
        <!-- ==                         MFA DEVICE ARN                       == -->
        <!-- ================================================================== -->
        <div class="form-group" style="width: 100%; display: inline-block;" *ngIf="sessionType === eAccountType.awsIamUser">
          <label>Mfa Device</label>
          <input formControlName="mfaDevice" type="text" class="form-control" placeholder="MFA arn or SN (optional)" />
        </div>

        <!-- ================================================================== -->
        <!-- ==                      SECRET & ACCESS KEYS                    == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType === eAccountType.awsIamUser">
          <h2>Add secret</h2>
          <div class="form-group" style="width: 49%; display: inline-block; position: relative; top: -1px;" >
            <label style="margin-bottom: 0;">Access  Key<span class="danger-text">*</span></label>
            <input formControlName="accessKey" type="text" class="form-control" placeholder="Access Key *">
          </div>

          <div style="width: 2%; height: 1px; display: inline-block;"></div>

          <div class="form-group" style="width: 49%; display: inline-block; position: relative; top: -1px;" >
            <label style="margin-bottom: 0;">Secret Key<span class="danger-text">*</span></label>
            <input formControlName="secretKey" type="text" class="form-control" placeholder="Secret Key *">
          </div>
        </ng-container>

        <!-- ================================================================== -->
        <!-- ==                       ASSUMER SESSIONS                       == -->
        <!-- ================================================================== -->
        <ng-container *ngIf="sessionType === eAccountType.awsIamRoleChained">
          <h2>Truster setting</h2>
          <div class="form-group" style="width: 100%; display: inline-block; position: relative; top: -1px;" >
            <label style="margin-bottom: 0;">Assumer Session<span class="danger-text">*</span> <i class="fa fa-question-circle" tooltip="This is the account used to make AssumeRole on the Truster Account"></i></label>
            <ng-select class="mt-2" formControlName="assumerSession" bindLabel="sessionName" bindValue="session" dropdownPosition="top" [items]="assumerAwsSessions" [(ngModel)]="selectedSession" [disabled]="true"></ng-select>
          </div>
        </ng-container>
      </ng-container>

      <!-- ================================================================= -->
      <!-- ==                  AZURE ACCOUNT PROPERTIES                   == -->
      <!-- ================================================================= -->
      <ng-container *ngIf="sessionType === eAccountType.azure">
        <div class="form-group" style="width: 100%; display: inline-block;">
          <label>Subscription Id<span class="danger-text">*</span></label>
          <input formControlName="subscriptionId" type="text" class="form-control" placeholder="Subscription Id *">
          <small class="text-error" *ngIf="(form.controls['subscriptionId'].dirty || form.controls['subscriptionId'].touched) && form.controls['subscriptionId'].errors">Insert the Subscription Id</small>
        </div>

        <div class="form-group" style="width: 100%; display: inline-block;">
          <label>Tenant Id<span class="danger-text">*</span></label>
          <input formControlName="tenantId" type="text" class="form-control" placeholder="Tenant Id *">
          <small class="text-error" *ngIf="(form.controls['tenantId'].dirty || form.controls['tenantId'].touched) && form.controls['tenantId'].errors">Insert the Tenant Id</small>
        </div>

        <div class="form-group" style="width: 100%; display: inline-block;">
          <label>Azure Location</label>
          <ng-select formControlName="azureLocation" bindLabel="location" bindValue="location" [items]="locations" [(ngModel)]="selectedLocation" dropdownPosition="top"></ng-select>
        </div>
      </ng-container>

      <!-- ================================================================== -->
      <!-- ==                             BUTTONS                          == -->
      <!-- ================================================================== -->
      <button type="button" (click)="saveSession();" [disabled]="!formValid()" [ngClass]="!formValid() ? 'pull-right disabled': 'pull-right'" *ngIf="sessionType">Save</button>
    </ng-container>
    <button type="button" (click)="goBack();" class="pull-left disabled">Back</button>
  </form>
</div>
